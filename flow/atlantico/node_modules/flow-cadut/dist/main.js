var t=require("@onflow/config"),e=require("@onflow/types"),r=require("@onflow/fcl");function n(t){if(t&&t.t)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,e}var o=n(e),s=n(r);const c={emulator:{FlowToken:"0xee82856bf20e2aa6",FungibleToken:"0x0ae53cb6e3f42a79"},testnet:{FlowToken:"0x7e60df042a9c0868",FungibleToken:"0x9a0766d93b6608b7",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FUSD:"0xe223d8a629e49c68"},mainnet:{FlowToken:"0x1654653399040a61",FungibleToken:"0xf233dcee88fe0abe",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FUSD:"0x3c5959b568896393"}},a={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},u=t=>t.split(/\s/).map(t=>t.replace(/\s/g,"")).filter(t=>t.length>0&&"import"!==t&&"from"!==t),i=(t,e)=>{const[r,n]=e;return t[r]=n,t},f=t=>t&&0!==t.length?t.split("\n").filter(t=>t.includes("import")).map(u).reduce(i,{}):{},p=(t,e={})=>{const r=f(t),n=[];for(const t in r)!e[t]&&Object.prototype.hasOwnProperty.call(r,t)&&n.push(t);return n},d=(t=[],e="")=>{const r="Missing imports for contracts:";console.error(e?`${e} ${r}`:r,t)},l=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,x=(t,e,r=!0)=>t.replace(l,(t,n,o,s,c)=>{const a=r?o:c;return`${n}${o} from ${(e instanceof Function?e(a):e[a])||c}`}),m=t=>{const[e]=t.split("");return e.toUpperCase()+t.slice(1)},g=t=>{switch(!0){case t.indexOf("//")>=0:return"//";case t.indexOf("/")>=0:return"/";case t.indexOf("\\")>=0:return"\\";default:return""}},w=t=>t.replace(/\s+/g," "),h=t=>t.split(",").map(t=>t.replace(/\s*/g,"")).filter(t=>""!==t),y=t=>t.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),b=(t,e)=>{const r=y(t),n=w(r.replace(/[\n\r]/g,""));if(n){const t=new RegExp(e,"g").exec(n);if(t)return""===t[1]?[]:h(t[1])}return[]},P=t=>b(t,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),$=t=>b(t,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),v=t=>b(t,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),S=t=>{const e=y(t).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),r=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(e);if(r.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:r[1],args:r[3]||""}},k=t=>{const e=y(t);if(/transaction\s*(\(\s*\))*\s*/g.test(e)){const t=P(e),r=v(e);return{type:"transaction",signers:t.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(e))return{type:"script",args:$(e)};if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(e)){const{contractName:t,args:r}=S(e);return{type:"contract",signers:1,args:r,contractName:t}}return{type:"unknown"}},F=t=>!t||"string"!=typeof t,E=t=>!F(t)&&(t.startsWith("Int")||t.startsWith("UInt")||t.startsWith("Word")),T=t=>{if(F(t))return!1;const e=t.replace(/\s/g,"");return e.startsWith("[")&&e.endsWith("]")},A=t=>{if(F(t))return!1;const e=t.replace(/\s/g,"");return e.startsWith("{")&&e.endsWith("}")},N=t=>T(t)||A(t),j=t=>t.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(t=>""!==t).map(t=>t.replace(/\s*/g,"")),I=t=>j(t)[1],O=t=>/{(.*)}/.exec(t)[1].split(/([^:]*):(.*)/).map(t=>t.replace(/\s/g,"")).filter(t=>t),L=t=>/\[(.*)\]/.exec(t)[1].replace(/\s+/g,""),U=t=>!F(t)&&(t.includes("?")?o.Optional(o[(t=>t.slice(0,-1))(t)]):o[t]),_=t=>{if(N(t))switch(!0){case T(t):{const e=L(t);return o.Array(_(e))}case A(t):{const[e,r]=O(t),n={key:_(e),value:_(r)};return o.Dictionary(n)}default:return U(t)}return U(t)},q=(t,e)=>{const r=_(t);switch(!0){case(t=>{if(F(t))return!1;let e=t.endsWith("?")?t.slice(0,-1):t;return E(e)||(t=>"String"===t)(e)||(t=>"Character"===t)(e)||(t=>"Bool"===t)(e)})(t):return s.arg(e,r);case(t=>!F(t)&&(t.startsWith("Fix64")||t.startsWith("UFix64")))(t):return null===e?s.arg(null,r):(isNaN(parseFloat(e))&&(t=>{throw new Error("Type Error: Expected proper value for fixed type")})(),s.arg(parseFloat(e).toFixed(8),r));case(t=>"Address"===t||"Address?"===t)(t):{const t=null==(n=e)?null:"0x"+(t=>null==t?null:t.replace(/^0x/,""))(n);return s.arg(t,r)}case T(t):{const n=L(t);if(N(n)){const t=e.map(t=>q(n,t).value);return s.arg(t,r)}return s.arg(e,r)}case A(t):{const[n,o]=O(t),c=[],a=Object.keys(e);for(let t=0;t<a.length;t++){const r=a[t];let s;s=N(o)?q(o,e[r]).value:e[r];const u=E(n)?parseInt(r):r;c.push({key:u,value:s})}return s.arg(c,r)}default:throw`${t} is not supported`}var n},C=(t=[],e)=>{if(e.length<t.length)throw new Error("Not enough arguments");return e.map((e,r)=>{const n=q(t[r],e);var o;return(o=n).xform.asArgument(o.value),n})},D=(t,e=[])=>{const r=k(t).args.map(I);return C(r,e)};function M(t,e){try{var r=t()}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}const B=function(e,r){try{const{code:n,cadence:o,args:c,addressMap:a,limit:u,processed:i}=e,f=n||o,p=i?f:x(f,a),d="script"===r?[s.script(p)]:[s.transaction(p)];return c&&d.push(s.args(((t,e)=>{if(0===t.length)return[];const r=t[0];return Array.isArray(r)&&r[r.length-1].asArgument?(t=>t.reduce((t,e)=>[...t,...((t,e)=>{const r=t[t.length-1];return t.slice(0,-1).map(t=>((t,e)=>s.arg(t,e))(t,r))})(e)],[]))(t):D(e,t)})(c,n))),Promise.resolve(t.config().get("ix.executionLimit")).then(function(t){if(d.push(s.limit(u||t||100)),"transaction"===r){const{proposer:t,payer:r,signers:n=[]}=e,o=0===n.length?[r]:n,c=t||r;d.push(s.payer(r)),d.push(s.proposer(c)),d.push(s.authorizations(o))}return s.send(d)})}catch(t){return Promise.reject(t)}},H=function(t){try{const{raw:e=!1}=t;return Promise.resolve(M(function(){return Promise.resolve(B(t,"script")).then(function(t){return e?[t.encodedData,null]:Promise.resolve(s.decode(t)).then(function(t){return[t,null]})})},function(t){return[null,t.message]}))}catch(t){return Promise.reject(t)}},R=function(t){try{const{wait:e="seal"}=t;return Promise.resolve(M(function(){return Promise.resolve(B(t,"transaction")).then(function(t){let r;function n(e){return r?e:[t.transactionId,null]}const o=function(){if(e){const n=(t=>{if("string"==typeof t){const e=t.toLowerCase();if(e.includes("final"))return"onceFinalized";if(e.includes("exec"))return"onceExecuted";if(e.includes("seal"))return"onceExecuted"}return console.log(`⚠️ [33mStatus value [1m[35m"${t}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(e);return Promise.resolve(s.tx(t)[n]()).then(function(e){const n={txId:t,...e};return r=1,[n,null]})}}();return o&&o.then?o.then(n):n(o)})},function(t){return[null,t.message]}))}catch(t){return Promise.reject(t)}},z=function(t){try{const{name:e,to:r,payer:n,proposer:o,code:s,update:c=!1,processed:a=!1,addressMap:u={}}=t,i=a?s:x(s,u),f=c?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",p=Buffer.from(i,"utf8").toString("hex");let d=r,l=r;return n&&(l=n,d=o||n),R({payer:l,proposer:d,signers:[r],code:f,args:[e,p]})}catch(t){return Promise.reject(t)}};exports.CONTRACT="contract",exports.SCRIPT="script",exports.TRANSACTION="transaction",exports.argType=I,exports.capitalizeFirstLetter=m,exports.collapseSpaces=w,exports.deployContract=z,exports.executeScript=H,exports.extract=b,exports.extractContractName=t=>{const e=y(t).replace(/\r\n|\n|\r/g," "),r=/\w+\s+contract\s+(?:interface)*\s*(\w*)/g.exec(e);if(r.length<2)throw new Error("Contract Error: can't find name of the contract");return r[1]},exports.extractContractParameters=S,exports.extractImports=f,exports.extractScriptArguments=$,exports.extractSigners=P,exports.extractTransactionArguments=v,exports.generateSchema=h,exports.getArrayType=L,exports.getDictionaryTypes=O,exports.getEnvironment=function(){try{return Promise.resolve(t.config().get("ix.env")).then(function(t){return c[t]||c.emulator})}catch(t){return Promise.reject(t)}},exports.getSplitCharacter=g,exports.getTemplateInfo=k,exports.mapArgument=q,exports.mapArguments=C,exports.mapValuesToCode=D,exports.missingImports=p,exports.mutate=R,exports.query=H,exports.replaceImportAddresses=x,exports.report=d,exports.reportArguments=(t,e,r="")=>{if(e>t){const n=`Incorrect number of arguments: found ${t} of ${e}`;console.error(r?`${r} ${n}`:n)}},exports.reportMissing=(t="items",e,r,n="")=>{if(r!==e){const o=`Incorrect number of ${t}: found ${e} of ${r}`;console.error(n?`${n} ${o}`:o)}},exports.reportMissingImports=(t,e,r="")=>{const n=p(t,e);n.length>0&&d(n,r)},exports.sendTransaction=R,exports.setEnvironment=function(e="emulator",r={}){try{const n=e.toLowerCase();if(!c[n])throw new Error(`Provided value "${n}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:s,limit:u}=r,i="emulator"===n&&o?`http://localhost:${o}`:a[n],f=s||i;return Promise.resolve(t.config().put("ix.env",n)).then(function(){function e(){return Promise.resolve(t.config().put("accessNode.api",f)).then(function(){})}const r=function(){if(u)return Promise.resolve(t.config().put("ix.executionLimit",u)).then(function(){})}();return r&&r.then?r.then(e):e()})}catch(t){return Promise.reject(t)}},exports.splitArgs=j,exports.trimAndSplit=(t,e,r)=>r?t.replace(e,"").split(r):t.replace(e,"").split(g(t)),exports.underscoreToCamelCase=t=>t.replace(/-/g,"_").split("_").map((t,e)=>e>0?m(t):t).join(""),exports.updateContract=function(t){try{return z({...t,update:!0})}catch(t){return Promise.reject(t)}};
//# sourceMappingURL=main.js.map
