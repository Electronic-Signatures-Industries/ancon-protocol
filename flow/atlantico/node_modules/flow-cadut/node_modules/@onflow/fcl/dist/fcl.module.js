import*as e from"@onflow/sdk";import{config as t,account as r,send as n,getTransactionStatus as o,decode as a,resolve as i,createSignableVoucher as s,pipe as c,interaction as u,latestBlock as d,encodeMessageFromSignable as l}from"@onflow/sdk";export{TestUtils,account,arg,args,atBlockHeight,atBlockId,authorization,authorizations,build,config,createSignableVoucher,decode,getAccount,getBlock,getBlockByHeight,getBlockById,getBlockHeader,getCollection,getEvents,getEventsAtBlockHeightRange,getEventsAtBlockIds,getLatestBlock,getTransaction,getTransactionStatus,invariant,isBad,isOk,latestBlock,limit,param,params,payer,ping,pipe,proposer,ref,script,send,transaction,validator,why}from"@onflow/sdk";import{invariant as f}from"@onflow/util-invariant";import*as p from"@onflow/types";import{INIT as h,SUBSCRIBE as v,UNSUBSCRIBE as m,spawn as y,send as E,UPDATED as g,SNAPSHOT as P,subscriber as C,snapshoter as R}from"@onflow/util-actor";import{withPrefix as S,sansPrefix as w}from"@onflow/util-address";export{display,sansPrefix,withPrefix}from"@onflow/util-address";import*as L from"@onflow/rlp";import{uid as b}from"@onflow/util-uid";export{template as cadence,template as cdc}from"@onflow/util-template";var A=function(e){try{return Promise.resolve(t().where(e)).then(function(t){return Object.fromEntries(Object.entries(t).map(function(t){var r=t[1];return[t[0].replace(e,""),r]}))})}catch(e){return Promise.reject(e)}};t({"discovery.wallet.method.default":"IFRAME/RPC","fcl.storage.default":{can:!0,get:function(e){try{return Promise.resolve(JSON.parse(sessionStorage.getItem(e)))}catch(e){return Promise.reject(e)}},put:function(e,t){try{return Promise.resolve(sessionStorage.setItem(e,JSON.stringify(t)))}catch(e){return Promise.reject(e)}}}});var I="0.0.77",F=function(e){return function(t){return typeof t===e}},O=function(e){return null!=e},N=F("object"),D=F("string"),k=F("function"),j=F("number");function T(t){return k(t)?t(e.arg,p):[]}var _=function(t){void 0===t&&(t={});try{return Promise.resolve(function(t){try{return f(O(t.cadence),"query({ cadence }) -- cadence is required"),f(D(t.cadence),"query({ cadence }) -- cadence must be a string"),Promise.resolve(e.config.get("accessNode.api")).then(function(e){f(e,'Required value for "accessNode.api" not defined in config. See: https://github.com/onflow/flow-js-sdk/blob/master/packages/fcl/src/exec/query.md#configuration')})}catch(e){return Promise.reject(e)}}(t)).then(function(){return e.send([e.script(t.cadence),e.args(T(t.args||[])),t.limit&&"number"==typeof t.limit&&e.limit(t.limit)]).then(e.decode)})}catch(e){return Promise.reject(e)}};function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var W={f_type:"Service",f_vsn:"1.0.0"},U={f_type:"Identity",f_vsn:"1.0.0"},z={f_type:"USER",f_vsn:"1.0.0"},H={f_type:"PollingResponse",f_vsn:"1.0.0"},Y={f_type:"CompositeSignature",f_vsn:"1.0.0"};function B(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({old:e},W,{type:"frame",endpoint:e.endpoint,params:e.params||{},data:e.data||{}})}}function J(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({},W,{type:"back-channel-rpc",endpoint:e.endpoint,method:e.method,params:e.params||{},data:e.data||{}})}}function q(e){if(null==e)return null;switch(null==e.method&&(e=V({},e,{type:"local-view",method:"VIEW/IFRAME"})),e.f_vsn){case"1.0.0":return e;default:return V({},W,{type:e.type||"local-view",method:e.method,endpoint:e.endpoint,data:e.data||{},params:e.params||{}})}}var K={"back-channel-rpc":J,"pre-authz":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({},W,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:V({},U,{address:S(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authz:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({},W,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:V({},U,{address:S(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authn:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({},W,{type:e.type,uid:e.id,endpoint:e.authn,id:e.pid,provider:{address:S(e.addr),name:e.name,icon:e.icon}})}},frame:B,"open-id":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return null}},"user-signature":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:throw new Error("Invalid user-signature service")}},"local-view":q};function G(e){return L.encode([e.provider.address||e.provider.name||"UNSPECIFIED",e.id]).toString("hex")}function Z(e,t){return void 0===e&&(e=[]),e.find(function(e){return e.type===t})}function $(e){var t=new URL(e.endpoint);if(t.searchParams.append("l6n",window.location.origin),null!=e.params)for(var r=0,n=Object.entries(e.params||{});r<n.length;r++){var o=n[r];t.searchParams.append(o[0],o[1])}return t}function X(e,t){void 0===t&&(t={});var r=t.method||"POST",n="GET"===r?void 0:JSON.stringify(t.data||e.data||{});return fetch($(e),{method:r,headers:V({},e.headers||{},t.headers||{},{"Content-Type":"application/json"}),body:n}).then(function(e){return e.json()})}function Q(e){var t;if(null==e)return null;switch((e.addr||e.services)&&(e={status:"APPROVED",data:V({},e)}),e.f_vsn){case"1.0.0":return e;default:return V({},H,{status:e.status,reason:null!=(t=e.reason)?t:null,data:e.compositeSignature||e.data||{},updates:J(e.authorizationUpdates),local:B((e.local||[])[0])})}}var ee=function e(t,r){void 0===r&&(r=function(){return!0});try{if(f(t,"Missing Polling Service",{service:t}),!r())throw new Error("Externally Halted");return Promise.resolve(X(t,{method:re(t)}).then(Q)).then(function(t){switch(t.status){case"APPROVED":return t.data;case"DECLINED":throw new Error("Declined: "+(t.reason||"No reason supplied."));default:return Promise.resolve(new Promise(function(e){return setTimeout(e,500)})).then(function(){return e(t.updates,r)})}})}catch(e){return Promise.reject(e)}},te={"HTTP/GET":"GET","HTTP/POST":"POST"},re=function(e){return f(te[e.method],"Invalid Service Method for type back-channel-rpc",{service:e}),te[e.method]},ne="FCL_IFRAME";function oe(e){f(!document.getElementById(ne),"Attempt at triggering multiple Frames",{src:e});var t=document.createElement("iframe");return t.src=e,t.id=ne,t.allow="usb *; hid *",t.frameBorder="0",t.style.cssText="\n  position:fixed;\n  top: 0px;\n  right: 0px;\n  bottom: 0px;\n  left: 0px;\n  height: 100vh;\n  width: 100vw;\n  display:block;\n  background:rgba(0,0,0,0.25);\n  z-index: 2147483647;\n  box-sizing: border-box;\n",document.body.append(t),[t.contentWindow,function(){document.getElementById(ne)&&document.getElementById(ne).remove()}]}var ae=null,ie=null;function se(e,t,r,n,o){return r.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+n+", height="+o+", top="+(r.top.outerHeight/2+r.top.screenY-o/2)+", left="+(r.top.outerWidth/2+r.top.screenX-n/2))}function ce(e){var t;null==ae||null!=(t=ae)&&t.closed?ae=se(e,"FCL_POP",window,640,600):ie!==e?(ae=se(e,"FCL_POP",window,640,600)).focus():ae.focus(),ie=e;var r=setInterval(function(){ae&&ae.closed&&(clearInterval(r),ae=null)},1e3);return[ae,function(){ae&&!ae.closed&&(ae.close(),ae=null)}]}var ue=null,de=null;function le(e){var t;null==ue||null!=(t=ue)&&t.closed?ue=window.open(e,"_blank"):de!==e?(ue=window.open(e,"_blank")).focus():ue.focus(),de=e;var r=setInterval(function(){ue&&ue.closed&&(clearInterval(r),ue=null)},1e3);return[ue,function(){ue&&!ue.closed&&(ue.close(),ue=null)}]}var fe,pe={"VIEW/IFRAME":oe,"VIEW/POP":ce,"VIEW/TAB":le},he=function(e,t,r){try{return t.data=e.data,Promise.resolve(X(e,{data:t}).then(Q)).then(function(t){if("APPROVED"===t.status)return t.data;if("DECLINED"===t.status)throw new Error("Declined: "+(t.reason||"No reason supplied."));if("PENDING"===t.status){var r=!0;return Promise.resolve(function(e,t){void 0===t&&(t={});try{try{return Promise.resolve(pe[e.method]($(e),t))}catch(r){throw console.error("execLocal({service, opts = {}})",r,{service:e,opts:t}),r}}catch(e){return Promise.reject(e)}}(q(t.local))).then(function(e){var n=e[1],o=function(){try{n(),r=!1}catch(e){console.error("Frame Close Error",e)}};return ee(t.updates,function(){return r}).then(function(e){return o(),e}).catch(function(e){throw console.error(e),o(),e})})}throw console.error("Auto Decline: Invalid Response",{service:e,resp:t}),new Error("Auto Decline: Invalid Response")})}catch(e){return Promise.reject(e)}},ve=function(){},me=function(e){return"string"==typeof e&&e.toLowerCase()},ye=function(e,t){return console.warn("DEPRECATION NOTICE","Received "+e+", please use "+t+" for this and future versions of FCL")},Ee=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]),ge=function(){},Pe=function(e){return"string"==typeof e&&e.toLowerCase()},Ce=function(e,t){return console.warn("DEPRECATION NOTICE","Received "+e+", please use "+t+" for this and future versions of FCL")},Re=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]),Se=function(){},we=function(e){return"string"==typeof e&&e.toLowerCase()},Le=function(e,t){return console.warn("DEPRECATION NOTICE","Received "+e+", please use "+t+" for this and future versions of FCL")},be=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]),Ae=function(e){var t=e.service,r=e.msg,n=void 0===r?{}:r,o=e.opts,a=void 0===o?{}:o;try{try{return Promise.resolve(Ie[t.method](t,n,a))}catch(e){throw console.error("execService({service, msg = {}, opts = {}})",e,{service:t,msg:n,opts:a}),e}}catch(e){return Promise.reject(e)}},Ie={"HTTP/RPC":he,"HTTP/POST":he,"IFRAME/RPC":function(e,t,r){return new Promise(function(n,o){var a=b(),i=r.includeOlderJsonRpcCall;t.data=e.data,function(e,t){if(void 0===t&&(t={}),null==e)return{send:ve,close:ve};var r=t.onClose||ve,n=t.onMessage||ve,o=t.onReady||ve,a=t.onResponse||ve;window.addEventListener("message",u);var i=oe($(e)),s=i[0],c=i[1];return{send:l,close:d};function u(e){try{if("object"!=typeof e.data)return;if(Ee.has(e.data.type))return;me(e.data.type)===me("FCL:VIEW:CLOSE")&&d(),me(e.data.type)===me("FCL:VIEW:READY")&&o(e,{send:l,close:d}),me(e.data.type)===me("FCL:VIEW:RESPONSE")&&a(e,{send:l,close:d}),n(e,{send:l,close:d}),me(e.data.type)===me("FCL:FRAME:READY")&&(ye(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),me(e.data.type)===me("FCL:FRAME:RESPONSE")&&(ye(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),me(e.data.type)===me("FCL:FRAME:CLOSE")&&(ye(e.data.type,"FCL:VIEW:CLOSE"),d()),me(e.data.type)===me("FCL::CHALLENGE::RESPONSE")&&(ye(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),me(e.data.type)===me("FCL::AUTHZ_READY")&&(ye(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),me(e.data.type)===me("FCL::CHALLENGE::CANCEL")&&(ye(e.data.type,"FCL:VIEW:CLOSE"),d()),me(e.data.type)===me("FCL::CANCEL")&&(ye(e.data.type,"FCL:VIEW:CLOSE"),d())}catch(e){console.error("Frame Callback Error",e),d()}}function d(){try{window.removeEventListener("message",u),c(),r()}catch(e){console.error("Frame Close Error",e)}}function l(e){try{s.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(t){console.error("Frame Send Error",e,t)}}}(e,{onReady:function(r,n){var o=n.send;try{return Promise.resolve(function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(function(){var r={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(n){return Promise.resolve(A(/^app\.detail\./)).then(function(s){o({type:"FCL:VIEW:READY:RESPONSE",body:t,service:r,config:{services:n,app:s}});var c={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(r){return Promise.resolve(A(/^app\.detail\./)).then(function(n){o({type:"FCL:FRAME:READY:RESPONSE",body:t,service:c,config:{services:r,app:n},deprecated:{message:"FCL:FRAME:READY:RESPONSE is deprecated and replaced with type: FCL:VIEW:READY:RESPONSE"}}),i&&o({jsonrpc:"2.0",id:a,method:"fcl:sign",params:[t,e.params],deprecated:{message:"jsonrpc is deprecated and replaced with type: FCL:VIEW:READY:RESPONSE"}})})})})})},function(e){throw e}))}catch(e){return Promise.reject(e)}},onResponse:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;var a=Q(e.data);switch(a.status){case"APPROVED":n(a.data),r();break;case"DECLINED":o("Declined: "+(a.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execIframeRPC onResponse error",e),e}},onMessage:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==a)return;var i=Q(e.data.result);switch(i.status){case"APPROVED":n(i.data),r();break;case"DECLINED":o("Declined: "+(i.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execIframeRPC onMessage error",e),e}},onClose:function(){o("Declined: Externally Halted")}})})},"POP/RPC":function(e,t,r){return new Promise(function(n,o){var a=b(),i=r.includeOlderJsonRpcCall;t.data=e.data,function(e,t){if(void 0===t&&(t={}),null==e)return{send:ge,close:ge};var r=t.onClose||ge,n=t.onMessage||ge,o=t.onReady||ge,a=t.onResponse||ge;window.addEventListener("message",u);var i=ce($(e)),s=i[0],c=i[1];return{send:l,close:d};function u(e){try{if("object"!=typeof e.data)return;if(Re.has(e.data.type))return;Pe(e.data.type)===Pe("FCL:VIEW:CLOSE")&&d(),Pe(e.data.type)===Pe("FCL:VIEW:READY")&&o(e,{send:l,close:d}),Pe(e.data.type)===Pe("FCL:VIEW:RESPONSE")&&a(e,{send:l,close:d}),n(e,{send:l,close:d}),Pe(e.data.type)===Pe("FCL:FRAME:READY")&&(Ce(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),Pe(e.data.type)===Pe("FCL:FRAME:RESPONSE")&&(Ce(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),Pe(e.data.type)===Pe("FCL:FRAME:CLOSE")&&(Ce(e.data.type,"FCL:VIEW:CLOSE"),d()),Pe(e.data.type)===Pe("FCL::CHALLENGE::RESPONSE")&&(Ce(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),Pe(e.data.type)===Pe("FCL::AUTHZ_READY")&&(Ce(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),Pe(e.data.type)===Pe("FCL::CHALLENGE::CANCEL")&&(Ce(e.data.type,"FCL:VIEW:CLOSE"),d()),Pe(e.data.type)===Pe("FCL::CANCEL")&&(Ce(e.data.type,"FCL:VIEW:CLOSE"),d())}catch(e){console.error("Popup Callback Error",e),d()}}function d(){try{window.removeEventListener("message",u),c(),r()}catch(e){console.error("Popup Close Error",e)}}function l(e){try{s.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(t){console.error("Popup Send Error",e,t)}}}(e,{onReady:function(r,n){var o=n.send;try{return Promise.resolve(function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(function(){var r={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(n){return Promise.resolve(A(/^app\.detail\./)).then(function(s){o({type:"FCL:VIEW:READY:RESPONSE",body:t,service:r,config:{services:n,app:s}});var c={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(r){return Promise.resolve(A(/^app\.detail\./)).then(function(n){o({type:"FCL:FRAME:READY:RESPONSE",body:t,service:c,config:{services:r,app:n},deprecated:{message:"FCL:FRAME:READY:RESPONSE is deprecated and replaced with type: FCL:VIEW:READY:RESPONSE"}}),i&&o({jsonrpc:"2.0",id:a,method:"fcl:sign",params:[t,e.params]})})})})})},function(e){throw e}))}catch(e){return Promise.reject(e)}},onResponse:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;var a=Q(e.data);switch(a.status){case"APPROVED":n(a.data),r();break;case"DECLINED":o("Declined: "+(a.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execPopRPC onResponse error",e),e}},onMessage:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==a)return;var i=Q(e.data.result);switch(i.status){case"APPROVED":n(i.data),r();break;case"DECLINED":o("Declined: "+(i.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execPopRPC onMessage error",e),e}},onClose:function(){o("Declined: Externally Halted")}})})},"TAB/RPC":function(e,t,r){return new Promise(function(n,o){var a=b(),i=r.includeOlderJsonRpcCall;t.data=e.data,function(e,t){if(void 0===t&&(t={}),null==e)return{send:Se,close:Se};var r=t.onClose||Se,n=t.onMessage||Se,o=t.onReady||Se,a=t.onResponse||Se;window.addEventListener("message",u);var i=le($(e)),s=i[0],c=i[1];return{send:l,close:d};function u(e){try{if("object"!=typeof e.data)return;if(be.has(e.data.type))return;we(e.data.type)===we("FCL:VIEW:CLOSE")&&d(),we(e.data.type)===we("FCL:VIEW:READY")&&o(e,{send:l,close:d}),we(e.data.type)===we("FCL:VIEW:RESPONSE")&&a(e,{send:l,close:d}),n(e,{send:l,close:d}),we(e.data.type)===we("FCL:FRAME:READY")&&(Le(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),we(e.data.type)===we("FCL:FRAME:RESPONSE")&&(Le(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),we(e.data.type)===we("FCL:FRAME:CLOSE")&&(Le(e.data.type,"FCL:VIEW:CLOSE"),d()),we(e.data.type)===we("FCL::CHALLENGE::RESPONSE")&&(Le(e.data.type,"FCL:VIEW:RESPONSE"),a(e,{send:l,close:d})),we(e.data.type)===we("FCL::AUTHZ_READY")&&(Le(e.data.type,"FCL:VIEW:READY"),o(e,{send:l,close:d})),we(e.data.type)===we("FCL::CHALLENGE::CANCEL")&&(Le(e.data.type,"FCL:VIEW:CLOSE"),d()),we(e.data.type)===we("FCL::CANCEL")&&(Le(e.data.type,"FCL:VIEW:CLOSE"),d())}catch(e){console.error("Tab Callback Error",e),d()}}function d(){try{window.removeEventListener("message",u),c(),r()}catch(e){console.error("Tab Close Error",e)}}function l(e){try{s.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(t){console.error("Tab Send Error",e,t)}}}(e,{onReady:function(r,n){var o=n.send;try{return Promise.resolve(function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(function(){var r={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(n){return Promise.resolve(A(/^app\.detail\./)).then(function(s){o({type:"FCL:VIEW:READY:RESPONSE",body:t,service:r,config:{services:n,app:s}});var c={params:e.params,data:e.data};return Promise.resolve(A(/^service\./)).then(function(r){return Promise.resolve(A(/^app\.detail\./)).then(function(n){o({type:"FCL:FRAME:READY:RESPONSE",body:t,service:c,config:{services:r,app:n},deprecated:{message:"FCL:FRAME:READY:RESPONSE is deprecated and replaced with type: FCL:VIEW:READY:RESPONSE"}}),i&&o({jsonrpc:"2.0",id:a,method:"fcl:sign",params:[t,e.params]})})})})})},function(e){throw e}))}catch(e){return Promise.reject(e)}},onResponse:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;var a=Q(e.data);switch(a.status){case"APPROVED":n(a.data),r();break;case"DECLINED":o("Declined: "+(a.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execPopRPC onResponse error",e),e}},onMessage:function(e,t){var r=t.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==a)return;var i=Q(e.data.result);switch(i.status){case"APPROVED":n(i.data),r();break;case"DECLINED":o("Declined: "+(i.reason||"No reason supplied")),r();break;default:o("Declined: No reason supplied"),r()}}catch(e){throw console.error("execPopRPC onMessage error",e),e}},onClose:function(){o("Declined: Externally Halted")}})})}},Fe=function(e,t){try{f(/^[0-9a-f]+$/i.test(e),"Message must be a hex string"),f(Array.isArray(t),"Must include an Array of composite signatures");var n=[],o=[],a=[];return Promise.resolve(Promise.all(t.map(function(e){try{return f("string"==typeof e.addr,"addr must be a string"),f("number"==typeof e.keyId,"keyId must be a number"),f("string"==typeof e.signature,"signature must be a string"),Promise.resolve(function(t,i){try{var s=Promise.resolve(r(e.addr)).then(function(t){return n.push(t.keys[e.keyId].weight.toFixed(1)),o.push(t.keys[e.keyId].signAlgo),a.push(e.signature),t.keys[e.keyId].publicKey})}catch(e){return i(e)}return s&&s.then?s.then(void 0,i):s}(0,function(e){throw e}))}catch(e){return Promise.reject(e)}}))).then(function(t){return Promise.resolve(_({cadence:""+Oe,args:function(r,i){return[r(e,i.String),r(t,i.Array([i.String])),r(n,i.Array(i.UFix64)),r(o,i.Array([i.UInt])),r(a,i.Array([i.String]))]}}))})}catch(e){return Promise.reject(e)}},Oe="\nimport Crypto\n    \npub fun main(\n  message: String,\n  rawPublicKeys: [String],\n  weights: [UFix64],\n  signAlgos: [UInt],\n  signatures: [String],\n): Bool {\n\n  let keyList = Crypto.KeyList()\n  \n  var i = 0\n  for rawPublicKey in rawPublicKeys {\n    keyList.add(\n      PublicKey(\n        publicKey: rawPublicKey.decodeHex(),\n        signatureAlgorithm: signAlgos[i] == 2 ? SignatureAlgorithm.ECDSA_P256 : SignatureAlgorithm.ECDSA_secp256k1 \n      ),\n      hashAlgorithm: HashAlgorithm.SHA3_256,\n      weight: weights[i],\n    )\n    i = i + 1\n  }\n\n  let signatureSet: [Crypto.KeyListSignature] = []\n\n  var j = 0\n  for signature in signatures {\n    signatureSet.append(\n      Crypto.KeyListSignature(\n        keyIndex: j,\n        signature: signature.decodeHex()\n      )\n    )\n    j = j + 1\n  }\n    \n  let signedData = message.decodeHex()\n  \n  return keyList.verify(\n    signatureSet: signatureSet,\n    signedData: signedData\n  )\n}\n";function Ne(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return V({},Y,{addr:w(e.addr||e.address),signature:e.signature||e.sig,keyId:e.keyId})}}function De(e,t,r){if(!e.s){if(r instanceof _e){if(!r.s)return void(r.o=De.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(De.bind(null,e,t),De.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var ke=function(e,t){try{return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n    verifyUserSignatures is no longer exported as fcl.currentUser().verifyUserSignatures\n    and is now available as fcl.verifyUserSignatures\n    ============================\n    ","font-weight:bold;font-family:monospace;"),Promise.resolve(Fe(e,t))}catch(e){return Promise.reject(e)}},je=function(e){try{return Be(),Promise.resolve(xe()).then(function(t){var r=Z(t.services,"user-signature");return f(r,"Current user must have authorized a signing service."),Me(function(){return Promise.resolve(Ae({service:r,msg:Xe(e)})).then(function(e){return Array.isArray(e)?e.map(function(e){return Ne(e)}):[Ne(e)]})},function(e){return e})})}catch(e){return Promise.reject(e)}},Te=function(e){try{return Be(),Promise.resolve(xe()).then(function(t){var r=Z(t.services,"authz"),n=Z(t.services,"pre-authz");return V({},e,n?{tempId:"CURRENT_USER",resolve:function(e,t){try{return Promise.resolve(Ae({service:n,msg:t})).then(Ke)}catch(e){return Promise.reject(e)}}}:{tempId:"CURRENT_USER",resolve:null,addr:w(r.identity.address),keyId:r.identity.keyId,sequenceNum:null,signature:null,signingFunction:function(e){try{return Promise.resolve(Ae({service:r,msg:e,opts:{includeOlderJsonRpcCall:!0}})).then(Ne)}catch(e){return Promise.reject(e)}}})})}catch(e){return Promise.reject(e)}},_e=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var a=1&o?t:r;if(a){try{De(n,1,a(this.v))}catch(e){De(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?De(n,1,t?t(o):o):r?De(n,1,r(o)):De(n,2,o)}catch(e){De(n,2,e)}},n},e}();function Ve(e){return e instanceof _e&&1&e.s}var xe=function(){try{return Promise.resolve(new Promise(function(e,r){try{return Be(),Promise.resolve(Ze()).then(function(r){return r.loggedIn&&Je(r)?e(r):Promise.resolve(t.first(["discovery.wallet","challenge.handshake"])).then(function(r){try{if(null==r)throw console.warn('Required value for "discovery.wallet" not defined in config. See: https://github.com/onflow/flow-js-sdk/blob/master/packages/fcl/src/exec/query.md#configuration'),new Error('Required config value "discovery.wallet" is not defined')}catch(e){console.error(e)}return Promise.resolve(t.first(["discovery.wallet.method","discovery.wallet.method.default"],"IFRAME/RPC")).then(function(t){var n=function(e,n){try{var o=Me(function(){return Promise.resolve(Ae({service:{endpoint:r,method:t}})).then(function(e){return Promise.resolve(function(e){try{var t=(e=function(e){return e.addr=e.addr?S(e.addr):null,e.paddr=e.paddr?S(e.paddr):null,e}(e)).services||[];return Promise.resolve(function(e,t){try{if(null==e||null==t)return Promise.resolve([]);var r=new URL(e);return r.searchParams.append("code",t),Promise.resolve(fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})).then(function(e){if(Array.isArray(e))return e;var t=[];if(Array.isArray(e.authorizations))for(var r,n=M(e.authorizations);!(r=n()).done;)t.push(V({type:"authz",keyId:e.keyId},r.value));return null!=e.provider&&t.push(V({type:"authn",id:"wallet-provider#authn"},e.provider)),t})}catch(e){return Promise.reject(e)}}(e.hks,e.code)).then(function(r){var n,o,a=(n=t,o=r,void 0===n&&(n=[]),void 0===o&&(o=[]),[].concat(n,o)).map(function(t){return function(e,t){try{return K[e.type](e,t)}catch(t){return console.error("Unrecognized FCL Service Type ["+e.type+"]",e,t),e}}(t,e)}),i=function(e,t){return t.find(function(e){return"authn"===e.type})}(0,a);return V({},z,{addr:S(e.addr),cid:G(i),loggedIn:!0,services:a,expiresAt:e.exp})})}catch(e){return Promise.reject(e)}}(e)).then(function(e){E(We,ze,e)})})},function(e){console.error("Error while authenticating",e)})}catch(e){return n(!0,e)}return o&&o.then?o.then(n.bind(null,!1),n.bind(null,!0)):n(!1,o)}(0,function(t,r){return Promise.resolve(Ze()).then(function(n){if(e(n),t)throw r;return r})});if(n&&n.then)return n.then(function(){})})})})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}};function Me(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var We="CURRENT_USER",Ue="CURRENT_USER/UPDATED",ze="SET_CURRENT_USER",He='{\n  "f_type": "User",\n  "f_vsn": "1.0.0",\n  "addr":null,\n  "cid":null,\n  "loggedIn":null,\n  "expiresAt":null,\n  "services":[]\n}',Ye=((fe={})[h]=function(e){try{return e.merge(JSON.parse(He)),Promise.resolve(t.first(["fcl.storage","fcl.storage.default"])).then(function(t){var r=function(){if(t.can)return Promise.resolve(function(e){try{var t=JSON.parse(He);return Promise.resolve(e.get(We)).then(function(r){return null!=r&&t.f_vsn!==r.f_vsn?(e.removeItem(We),t):r||t})}catch(e){return Promise.reject(e)}}(t)).then(function(t){Je(t)&&e.merge(t)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},fe[v]=function(e,t){e.subscribe(t.from),e.send(t.from,Ue,V({},e.all()))},fe[m]=function(e,t){e.unsubscribe(t.from)},fe.SNAPSHOT=function(e,t){try{return t.reply(V({},e.all())),Promise.resolve()}catch(e){return Promise.reject(e)}},fe[ze]=function(e,r,n){try{return e.merge(n),Promise.resolve(t.first(["fcl.storage","fcl.storage.default"])).then(function(t){t.can&&t.put(We,e.all()),e.broadcast(Ue,V({},e.all()))})}catch(e){return Promise.reject(e)}},fe.DEL_CURRENT_USER=function(e,r){try{return e.merge(JSON.parse(He)),Promise.resolve(t.first(["fcl.storage","fcl.storage.default"])).then(function(t){t.can&&t.put(We,e.all()),e.broadcast(Ue,V({},e.all()))})}catch(e){return Promise.reject(e)}},fe),Be=function(){return y(Ye,We)};function Je(e){return null==e.expiresAt||0===e.expiresAt||e.expiresAt>Date.now()}function qe(){Be(),E(We,"DEL_CURRENT_USER")}function Ke(e){var t=function(e){return{f_type:"PreAuthzResponse",f_vsn:"1.0.0",proposer:(e||{}).proposer,payer:(e||{}).payer||[],authorization:(e||{}).authorization||[]}}(e),r=[];null!=t.proposer&&r.push(["PROPOSER",t.proposer]);for(var n,o=M(t.payer||[]);!(n=o()).done;)r.push(["PAYER",n.value]);for(var a,i=M(t.authorization||[]);!(a=i()).done;)r.push(["AUTHORIZER",a.value]);return r.map(function(e){var t=e[0],r=e[1];return{tempId:[r.identity.address,r.identity.keyId].join("|"),addr:r.identity.address,keyId:r.identity.keyId,signingFunction:function(e){return Ae({service:r,msg:e})},role:{proposer:"PROPOSER"===t,payer:"PAYER"===t,authorizer:"AUTHORIZER"===t}}})}function Ge(e){Be();var t="@EXIT",r=y(function(r){try{var n;return r.send(We,v),Promise.resolve(function(e,t,r){for(var n;;){var o=e();if(Ve(o)&&(o=o.v),!o)return a;if(o.then){n=0;break}var a=r();if(a&&a.then){if(!Ve(a)){n=1;break}a=a.s}}var i=new _e,s=De.bind(null,i,2);return(0===n?o.then(u):1===n?a.then(c):(void 0).then(function(){(o=e())?o.then?o.then(u).then(void 0,s):u(o):De(i,1,a)})).then(void 0,s),i;function c(t){a=t;do{if(!(o=e())||Ve(o)&&!o.v)return void De(i,1,a);if(o.then)return void o.then(u).then(void 0,s);Ve(a=r())&&(a=a.v)}while(!a||!a.then);a.then(c).then(void 0,s)}function u(e){e?(a=r())&&a.then?a.then(c).then(void 0,s):c(a):De(i,1,a)}}(function(){return!n&&1},0,function(){return Promise.resolve(r.receive()).then(function(o){if(o.tag===t)return r.send(We,m),void(n=1);e(o.data)})}))}catch(e){return Promise.reject(e)}});return function(){return E(r,t)}}function Ze(){return Be(),E(We,"SNAPSHOT",null,{expectReply:!0,timeout:0})}var $e,Xe=function(e){return f(/^[0-9a-f]+$/i.test(e),"Message must be a hex string"),{message:e}},Qe=function(){return{authenticate:xe,unauthenticate:qe,authorization:Te,signUserMessage:je,verifyUserSignatures:ke,subscribe:Ge,snapshot:Ze}};Qe.authenticate=xe,Qe.unauthenticate=qe,Qe.authorization=Te,Qe.signUserMessage=je,Qe.verifyUserSignatures=ke,Qe.subscribe=Ge,Qe.snapshot=Ze;var et=function(e){try{return Promise.resolve(n([o(e)]).then(a))}catch(e){return Promise.reject(e)}},tt=function(e){return e.status>=4},rt=function(e){return e.status>=3},nt=function(e){return e.status>=2},ot=(($e={})[h]=function(e){try{return Promise.resolve(et(e.self())).then(function(t){tt(t)||setTimeout(function(){return e.sendSelf("POLL")},2500),e.merge(t)})}catch(e){return Promise.reject(e)}},$e[v]=function(e,t){e.subscribe(t.from),e.send(t.from,g,e.all())},$e[m]=function(e,t){e.unsubscribe(t.from)},$e[P]=function(e,t){try{return t.reply(e.all()),Promise.resolve()}catch(e){return Promise.reject(e)}},$e.POLL=function(e){try{return Promise.resolve(et(e.self())).then(function(t){var r,n;tt(t)||setTimeout(function(){return e.sendSelf("POLL")},2500),r=e.all(),n=t,JSON.stringify(r)!==JSON.stringify(n)&&e.broadcast(g,t),e.merge(t)})}catch(e){return Promise.reject(e)}},$e),at=function(e){if("object"==typeof e&&(e=e.transactionId),null==e)throw new Error("transactionId required");return e},it=function(e){return y(ot,at(e))};function st(e){function t(t){return C(at(e),it,t)}function r(e){return function(r){void 0===r&&(r={});var n=r.suppress||!1;return new Promise(function(r,o){var a=t(function(t){t.statusCode&&!n?(o(t.errorMessage),a()):e(t)&&(r(t),a())})})}}return{snapshot:function(){return R(e,it)},subscribe:t,onceFinalized:r(nt),onceExecuted:r(rt),onceSealed:r(tt)}}st.isUnknown=function(e){return e.status>=0},st.isPending=function(e){return e.status>=1},st.isFinalized=nt,st.isExecuted=rt,st.isSealed=tt,st.isExpired=function(e){return 5===e.status};var ct,ut=function(t){void 0===t&&(t={});try{return Promise.resolve(function(r,n){try{var o=Promise.resolve(function(t){try{return f(O(t),"mutate(opts) -- opts is required"),f(N(t),"mutate(opts) -- opts must be an object"),f(O(t.cadence),"mutate({ cadence }) -- cadence is required"),f(D(t.cadence),"mutate({ cadence }) -- cadence must be a string"),Promise.resolve(e.config.get("accessNode.api")).then(function(e){f(e,'Required value for "accessNode.api" not defined in config. See: https://github.com/onflow/flow-js-sdk/blob/master/packages/fcl/src/exec/query.md#configuration')})}catch(e){return Promise.reject(e)}}(t)).then(function(){return Promise.resolve(e.config().get("fcl.authz",Qe().authorization)).then(function(r){return e.send([e.transaction(t.cadence),e.args(T(t.args||[])),t.limit&&j(t.limit)&&e.limit(t.limit),e.proposer(t.proposer||t.authz||r),e.payer(t.payer||t.authz||r),e.authorizations(t.authorizations||[t.authz||r])]).then(e.decode)})})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){throw e}))}catch(e){return Promise.reject(e)}},dt=function(e,r){void 0===e&&(e=[]),void 0===r&&(r={});try{return Promise.resolve(t.first(["sdk.resolve"],r.resolve||i)).then(function(t){function r(){return Promise.resolve(t(e)).then(function(e){return JSON.stringify(s(e),null,2)})}var n=function(){if(Array.isArray(e))return Promise.resolve(c(u(),e)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()})}catch(e){return Promise.reject(e)}},lt=function(e){try{var r=setTimeout;return Promise.resolve(t().get("fcl.eventPollRate",1e4)).then(function(t){return r(function(){return e.sendSelf("TICK")},t)})}catch(e){return Promise.reject(e)}},ft=((ct={}).TICK=function(e){try{if(!e.hasSubs())return Promise.resolve();var t=e.get("hwm"),r=function(){if(null==t){var r=e.put;return Promise.resolve(d()).then(function(t){r.call(e,"hwm",t);var n=e.put;return Promise.resolve(lt(e)).then(function(t){n.call(e,"tick",t)})})}return Promise.resolve(d()).then(function(r){return e.put("hwm",r),Promise.resolve(n([getEvents(e.self(),t.height,r.height-1)]).then(a)).then(function(t){for(var r,n=M(t);!(r=n()).done;)e.broadcast("UPDATED",r.value.data);var o=e.put;return Promise.resolve(lt(e)).then(function(t){o.call(e,"tick",t)})})})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},ct[v]=function(e,t){try{var r=function(){e.subscribe(t.from)},n=function(){if(!e.hasSubs()){var t=e.put;return Promise.resolve(lt(e)).then(function(r){t.call(e,"tick",r)})}}();return Promise.resolve(n&&n.then?n.then(r):r())}catch(e){return Promise.reject(e)}},ct[m]=function(e,t){e.unsubscribe(t.from),e.hasSubs()||(clearTimeout(e.get("tick")),e.delete("tick"),e.delete("hwm"))},ct),pt=function(e){return y(ft,e)};function ht(e){return{subscribe:function(t){return C(e,pt,t)}}}var vt=function(e,t){void 0===t&&(t={}),window.location!==window.parent.location?window.parent.postMessage(V({},t,{type:e}),"*"):window.opener.postMessage(V({},t,{type:e}),"*")},mt={__proto__:null,sendMsgToFCL:vt,close:function(){vt("FCL:VIEW:CLOSE")},approve:function(e){vt("FCL:VIEW:RESPONSE",{f_type:"PollingResponse",f_vsn:"1.0.0",status:"APPROVED",reason:null,data:e})},decline:function(e){vt("FCL:VIEW:RESPONSE",{f_type:"PollingResponse",f_vsn:"1.0.0",status:"DECLINED",reason:e,data:null})},onMessageFromFCL:function(e,t){void 0===t&&(t=function(){});var r=function(r){var n=r.data;"object"==typeof n&&null!=typeof n&&n.type===e&&t(function(e){var t;return e.deprecated&&console.warn("DEPRECATION NOTICE",e.deprecated.message),null==e||null==(t=e.body)||delete t.interaction,e}(n))};return window.addEventListener("message",r),function(){return window.removeEventListener("message",r)}},encodeMessageFromSignable:l,CompositeSignature:function(e,t,r){this.f_type=Y.f_type,this.f_vsn=Y.f_vsn,this.addr=S(e),this.keyId=Number(t),this.signature=r}},yt=function(){return Qe().authenticate()},Et=function(){return Qe().unauthenticate()},gt=function(){return Qe().unauthenticate(),Qe().authenticate()},Pt=function(){return Qe().authenticate()},Ct=function(){return Qe().authenticate()},Rt=Qe().authorization,St=p;export{I as VERSION,mt as WalletUtils,yt as authenticate,Rt as authz,Qe as currentUser,ht as events,Ct as logIn,ut as mutate,_ as query,gt as reauthenticate,dt as serialize,Pt as signUp,St as t,st as tx,Et as unauthenticate,Fe as verifyUserSignatures};
//# sourceMappingURL=fcl.module.js.map
